<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JavaScript Concepts - Free Interactive Playground</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
      body {
        background: #0f172a;
        color: white;
        font-family: ui-monospace, SFMono-Regular, monospace;
      }

      .neon {
        color: #22d3ee;
      }

      .sidebar-scroll::-webkit-scrollbar {
        width: 6px;
      }
      .sidebar-scroll::-webkit-scrollbar-thumb {
        background: #22d3ee;
        border-radius: 4px;
      }

      #codeEditor,
      #lineNumbers {
        font-family:
          "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
        font-size: 15px;
        line-height: 1.6;
      }

      #codeEditor {
        white-space: pre;
        overflow-wrap: normal;
        padding: 24px !important;
        resize: none;
      }

      #lineNumbers {
        padding: 24px 12px 24px 0;
        line-height: 1.6;
        user-select: none;
      }

      .concept-item {
        cursor: pointer;
        padding: 8px 12px;
        border-radius: 4px;
        transition: all 0.2s;
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: relative;
      }

      .concept-item:hover {
        background-color: #334155;
      }

      .concept-item.active {
        background-color: #0ea5e9;
        color: white;
      }

      .concept-item .star-btn {
        opacity: 0;
        transition: opacity 0.2s;
        background: none;
        border: none;
        color: #fbbf24;
        cursor: pointer;
        font-size: 14px;
        padding: 0 4px;
      }

      .concept-item:hover .star-btn {
        opacity: 1;
      }

      .category-header {
        margin-top: 12px;
        margin-bottom: 8px;
        font-weight: 600;
        color: #22d3ee;
        font-size: 12px;
        text-transform: uppercase;
        padding-left: 12px;
      }

      .output-item {
        padding: 10px 14px;
        margin: 6px 0;
        border-left: 3px solid #22d3ee;
        background: rgba(34, 211, 238, 0.08);
        border-radius: 3px;
        word-break: break-all;
        font-size: 14px;
      }

      .output-item.error {
        border-left-color: #f87171;
        color: #fca5a5;
        background: rgba(244, 63, 94, 0.08);
      }

      .output-item.success {
        border-left-color: #4ade80;
        color: #86efac;
        background: rgba(74, 222, 128, 0.08);
      }

      .profile-section {
        display: flex;
        align-items: center;
        gap: 12px;
        position: relative;
      }

      .profile-pic {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 2px solid #22d3ee;
        cursor: pointer;
        transition: all 0.2s;
      }

      .profile-pic:hover {
        box-shadow: 0 0 15px rgba(34, 211, 238, 0.4);
      }

      .profile-dropdown {
        position: absolute;
        top: 100%;
        right: 0;
        margin-top: 8px;
        background: #1e293b;
        border: 1px solid rgba(34, 211, 238, 0.3);
        border-radius: 8px;
        padding: 12px;
        min-width: 220px;
        z-index: 1000;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        display: none;
      }

      .profile-dropdown.active {
        display: block;
        animation: slideDownFade 0.3s ease-out;
      }

      @keyframes slideDownFade {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .profile-dropdown-item {
        padding: 8px 12px;
        margin: 4px 0;
        border-radius: 4px;
        font-size: 13px;
        color: #cbd5e1;
      }

      .profile-dropdown-item.info {
        border-bottom: 1px solid rgba(34, 211, 238, 0.2);
        margin-bottom: 8px;
        padding-bottom: 8px;
      }

      .profile-dropdown-item.info strong {
        color: #22d3ee;
      }

      .logout-btn {
        padding: 8px 14px;
        font-size: 13px;
        font-weight: 600;
        background: transparent;
        border: 1.5px solid rgba(148, 163, 184, 0.4);
        color: #94a3b8;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.2s;
        width: 100%;
        text-align: left;
      }

      .logout-btn:hover {
        background: rgba(244, 63, 94, 0.15);
        border-color: #f43f5e;
        color: #f87171;
      }

      .run-button-primary {
        padding: 10px 24px !important;
        font-size: 14px !important;
        font-weight: 700 !important;
        background: linear-gradient(
          135deg,
          #3b82f6 0%,
          #1d4ed8 100%
        ) !important;
        border: none !important;
        color: white !important;
        border-radius: 6px !important;
        cursor: pointer;
        transition: all 0.3s !important;
        box-shadow: 0 0 20px rgba(59, 130, 246, 0.3) !important;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
      }

      .run-button-primary:hover {
        background: linear-gradient(
          135deg,
          #1d4ed8 0%,
          #1e40af 100%
        ) !important;
        box-shadow: 0 0 30px rgba(59, 130, 246, 0.5) !important;
        transform: translateY(-2px);
      }

      .run-button-primary:active {
        transform: translateY(0);
      }

      .toolbar-separator {
        width: 1px;
        height: 24px;
        background: rgba(34, 211, 238, 0.2);
        margin: 0 12px;
      }

      .section-divider {
        border-left: 2px solid rgba(34, 211, 238, 0.15);
      }
    </style>
  </head>
  <body>
    <!-- SECURITY GUARD -->
    <script>
      const userData = localStorage.getItem("js_playground_user");
      if (!userData) {
        window.location.href = "login.html";
      }
    </script>

    <!-- LEFT SIDEBAR: Concepts List -->
    <div class="flex h-screen overflow-hidden">
      <div
        class="w-80 flex flex-col border-r border-slate-700 bg-slate-900/50 backdrop-blur z-10"
      >
        <div class="p-4 pb-3 border-b border-slate-800">
          <h1 class="text-lg font-bold neon mb-3">âœ¨ JS Concepts</h1>

          <input
            id="searchInput"
            type="text"
            placeholder="Search concepts... (Ctrl+K)"
            class="w-full p-2 rounded bg-slate-800 text-white text-sm outline-none focus:ring-1 focus:ring-cyan"
          />
        </div>

        <div
          id="conceptList"
          class="flex-1 overflow-y-auto sidebar-scroll p-2"
        ></div>
      </div>

      <!-- CENTER: Code Editor -->
      <div class="flex-1 flex flex-col min-w-0 bg-[#0f172a]">
        <!-- Toolbar -->
        <div
          class="h-16 border-b border-slate-700 flex justify-between items-center px-6 bg-slate-800/40"
        >
          <h2
            id="conceptTitle"
            class="text-base font-bold text-cyan-400 truncate flex-1"
          >
            Select a Concept
          </h2>
          <div class="flex items-center gap-2">
            <button
              id="copyBtn"
              class="px-3 py-2 text-xs font-semibold bg-slate-700 hover:bg-slate-600 rounded text-slate-200 transition"
            >
              Copy
            </button>
            <button
              id="exportBtn"
              class="px-3 py-2 text-xs font-semibold bg-slate-700 hover:bg-slate-600 rounded text-slate-200 transition"
            >
              Export
            </button>
            <button
              id="resetBtn"
              class="px-3 py-2 text-xs font-semibold bg-slate-700 hover:bg-slate-600 rounded text-slate-200 transition"
            >
              Reset
            </button>

            <!-- Run Button (Electric Blue) -->
            <button id="runBtn" class="run-button-primary">â–¶ Run Code</button>

            <div class="toolbar-separator"></div>

            <!-- User Profile (Top Right) -->
            <div class="profile-section">
              <img
                id="profilePic"
                class="profile-pic"
                alt="Profile"
                title="Click for menu"
              />

              <div id="profileDropdown" class="profile-dropdown">
                <div class="profile-dropdown-item info">
                  <strong id="userNameDisplay">User</strong>
                  <br />
                  <span
                    id="userEmailDisplay"
                    style="font-size: 11px; color: #64748b"
                  ></span>
                </div>

                <button id="logoutBtn" class="logout-btn">ðŸšª Logout</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Editor Area -->
        <div class="flex-1 relative flex overflow-hidden">
          <div
            id="lineNumbers"
            class="bg-[#0f172a] text-slate text-right select-none border-r border-slate-800 overflow-hidden py-6"
            style="
              width: 50px;
              font-size: 15px;
              line-height: 1.6;
              color: #475569;
            "
          >
            1
          </div>
          <textarea
            id="codeEditor"
            class="flex-1 h-full bg-[#0f172a] text-green-400 outline-none font-mono"
            spellcheck="false"
            placeholder="// Select a concept to load code here..."
          ></textarea>
        </div>
      </div>

      <!-- RIGHT PANEL: Output -->
      <div
        class="section-divider w-96 flex flex-col bg-slate-900 overflow-hidden"
      >
        <div
          class="px-4 py-3 bg-slate-800/60 text-xs font-bold text-slate-400 uppercase tracking-widest border-b border-slate-700"
        >
          ðŸ’» Output & Results
        </div>
        <div
          id="visualArea"
          class="flex-1 p-5 overflow-auto bg-slate-950 space-y-2"
        ></div>
      </div>
    </div>

    <script src="concepts.js"></script>
    <script>
      // ==========================================
      // GLOBAL STATE
      // ==========================================
      let currentConcept = null;
      const favorites = new Set(
        JSON.parse(localStorage.getItem("favorites") || "[]"),
      );

      // ==========================================
      // LOG FUNCTION
      // ==========================================
      window.log = function (message, type = "log") {
        const item = document.createElement("div");
        item.className =
          "output-item " +
          (type === "error" ? "error" : type === "success" ? "success" : "");
        item.textContent = "> " + message;
        visualArea.appendChild(item);
        visualArea.scrollTop = visualArea.scrollHeight;
      };

      // ==========================================
      // SIDEBAR RENDERING - ALL CONCEPTS ACCESSIBLE
      // ==========================================
      function renderSidebar(filter = "") {
        const sidebar = document.getElementById("conceptList");
        sidebar.innerHTML = "";

        // Show ALL concepts (no filtering)
        const grouped = {};
        CONCEPT_DATA.forEach((concept) => {
          if (!grouped[concept.category]) grouped[concept.category] = [];
          grouped[concept.category].push(concept);
        });

        Object.entries(grouped).forEach(([category, concepts]) => {
          const header = document.createElement("div");
          header.className = "category-header";
          header.textContent = category;
          sidebar.appendChild(header);

          concepts.forEach((concept) => {
            if (
              filter &&
              !concept.title.toLowerCase().includes(filter.toLowerCase())
            )
              return;

            const item = document.createElement("div");
            item.className = "concept-item";
            item.dataset.id = concept.id;

            const titleSpan = document.createElement("span");
            titleSpan.textContent = concept.title;
            titleSpan.style.flex = 1;

            const starBtn = document.createElement("button");
            starBtn.className = "star-btn";
            starBtn.textContent = favorites.has(concept.id) ? "â˜…" : "â˜†";
            starBtn.onclick = (e) => {
              e.stopPropagation();
              if (favorites.has(concept.id)) {
                favorites.delete(concept.id);
              } else {
                favorites.add(concept.id);
              }
              localStorage.setItem(
                "favorites",
                JSON.stringify(Array.from(favorites)),
              );
              starBtn.textContent = favorites.has(concept.id) ? "â˜…" : "â˜†";
            };

            item.appendChild(titleSpan);
            item.appendChild(starBtn);

            item.onclick = () => {
              loadConcept(concept);
            };

            sidebar.appendChild(item);
          });
        });
      }

      // ==========================================
      // LOAD CONCEPT
      // ==========================================
      function loadConcept(concept) {
        currentConcept = concept;
        document.getElementById("conceptTitle").textContent = concept.title;
        document.getElementById("codeEditor").value = concept.code;
        document.getElementById("visualArea").innerHTML = "";
        updateLineNumbers();

        document.querySelectorAll(".concept-item").forEach((item) => {
          item.classList.remove("active");
        });
        document
          .querySelector(`[data-id="${concept.id}"]`)
          ?.classList.add("active");
      }

      // ==========================================
      // EXECUTE CODE
      // ==========================================
      document.getElementById("runBtn").onclick = () => {
        const code = document.getElementById("codeEditor").value;
        document.getElementById("visualArea").innerHTML = "";

        try {
          const func = new Function("log", "visualArea", code);
          func(log, document.getElementById("visualArea"));
        } catch (err) {
          log("Error: " + err.message, "error");
        }
      };

      // ==========================================
      // LINE NUMBERS
      // ==========================================
      const editor = document.getElementById("codeEditor");
      const lineNumbers = document.getElementById("lineNumbers");

      function updateLineNumbers() {
        const lines = editor.value.split("\n").length;
        lineNumbers.innerHTML = Array(lines)
          .fill(0)
          .map((_, i) => i + 1)
          .join("<br>");
      }

      editor.addEventListener("input", updateLineNumbers);
      editor.addEventListener("scroll", () => {
        lineNumbers.scrollTop = editor.scrollTop;
      });

      // ==========================================
      // TOOLBAR BUTTONS
      // ==========================================
      document.getElementById("copyBtn").onclick = () => {
        const code = document.getElementById("codeEditor").value;
        navigator.clipboard.writeText(code).then(() => {
          log("âœ“ Code copied!", "success");
        });
      };

      document.getElementById("exportBtn").onclick = () => {
        const code = document.getElementById("codeEditor").value;
        const title = document.getElementById("conceptTitle").textContent;
        const timestamp = new Date().toISOString().slice(0, 19);
        const content = `// ${title}\n// Exported: ${timestamp}\n\n${code}`;

        const blob = new Blob([content], { type: "text/javascript" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `${title.replace(/\s+/g, "_")}_${timestamp.replace(/:/g, "-")}.js`;
        a.click();
        URL.revokeObjectURL(url);
        log("âœ“ Code exported!", "success");
      };

      document.getElementById("resetBtn").onclick = () => {
        if (currentConcept) {
          document.getElementById("codeEditor").value = currentConcept.code;
          updateLineNumbers();
          log("âœ“ Code reset", "success");
        }
      };

      // ==========================================
      // USER PROFILE & LOGOUT
      // ==========================================
      function loadUserProfile() {
        const user = JSON.parse(localStorage.getItem("js_playground_user"));
        if (user) {
          document.getElementById("profilePic").src = user.picture;
          document.getElementById("profilePic").title = user.name;
          document.getElementById("userNameDisplay").textContent = user.name;
          document.getElementById("userEmailDisplay").textContent = user.email;
        }
      }

      document.getElementById("profilePic").onclick = () => {
        const dropdown = document.getElementById("profileDropdown");
        dropdown.classList.toggle("active");
      };

      document.addEventListener("click", (e) => {
        if (!e.target.closest(".profile-section")) {
          document.getElementById("profileDropdown").classList.remove("active");
        }
      });

      document.getElementById("logoutBtn").onclick = () => {
        localStorage.removeItem("js_playground_user");
        localStorage.removeItem("favorites");
        window.location.href = "login.html";
      };

      // ==========================================
      // SEARCH
      // ==========================================
      document.getElementById("searchInput").addEventListener("input", (e) => {
        renderSidebar(e.target.value);
      });

      document.addEventListener("keydown", (e) => {
        if ((e.ctrlKey || e.metaKey) && e.key === "k") {
          e.preventDefault();
          document.getElementById("searchInput").focus();
        }
      });

      // ==========================================
      // INITIALIZE
      // ==========================================
      loadUserProfile();
      renderSidebar();
      if (CONCEPT_DATA.length > 0) {
        loadConcept(CONCEPT_DATA[0]);
      }
      updateLineNumbers();

      log("âœ“ JavaScript Concepts Playground loaded! (100% FREE)", "success");
    </script>
  </body>
</html>
